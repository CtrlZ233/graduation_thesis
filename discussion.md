## 向勇对廖东海学位论文的修改意见

### 摘要（20250312）

* 背景：论文要解决什么问题
 - 微内核相比宏内核，以同步IPC作为系统请求的主要方式
 - 现代微内核在设计层面上有三点不足
* 论文贡献：你做了什么工作，如何做的；
 - 精简为内核：在内核中移除同步IPC，在用户态通过通知机制实现异步IPC
 - 减少特权级切换开销：利用用户态中断改造通知机制，避免特权级切换。
 - 增强并发性和易用性：借助异步通知机制和异步运行时实现异步IPC和异步系统调用。
* 论文工作的评价：你的工作做得怎么样；
 - 使用sel4test证明了ReL4的正确性和对seL4的兼容性。
 - 分别对U-notification、异步系统调用、异步IPC进行了对比测试，证明了ReL4在高并发场景下对性能有显著提升，同时在低并发场景下仍然保持一定的竞争力。
 - 在ReL4上对真实的网络服务器进行了压力测试：证明了异步微内核框架有着良好的性能稳定性和多核扩展性。

### 第一章（20250323）

1. 1.2.2节的第二段可以不提你的设计。建议先说已有的微内核操作系统中的特权级切换开销、优化方案和效果；最后总结已有做法后，再说可能的改进思路。
    - 已修改
2. 1.2.2节关于异步编程的软件方法，可以单独形成一节。建议从中断、信号、epoll和io_uring，再说各种语言对异步编程的支持和效果进行综述。这是你的异步系统调用和异步IPC的重要基础。这里有一个重要且需要讨论，但论文中没有涉及的问题是，为什么用Rust重写seL4？
    - 已在1.2.3节新增Rust异步相关描述以及选用Rust的原因。

### 第二章（20250323）

1. 注意文献引用规范，图2.1需要明确注明出处。这在学校的查重中有重要影响。即使是综述引用，你也需要从自己的学位角度进行重新组织。
   - 这张图是自己画的，借鉴了seL4白皮书的一张图的风格，但内容不完全相同。
2. 建议在描述seL4的各种机制时，提供一些关于为什么这样设计的论述，以帮助帮助读者理解，也说明你对它的掌握程度。类似于综述中对已有工作的特征分析。如能力机制实质上是对资源管理的抽象，让内核可以有效管理所有资源的分配和回收状态。能力对象的转移描述了资源所有者变更，派生描述资源分配和回收的层次结构。这与Rust语言的所有权机制可以形成很好的契合。为后续论文中用Rust重写seL4做铺垫。
    - 这里的理解是需要添加论述的内容吗？如果是的话，已经在修改中添加相关论述的内容（包括这些设计的目的，或者这样设计的好处）。
3. “我们将含有相同能力空间和地址空间的称为同一个进程”，会有地址空间相同但能力空间不同的情况吗？
    - 理论上是可以有的，seL4没有地址空间和能力空间的强约束。
4. 2.2.3节中，利用TAIC的支持后，ReL4的调度对象是线程还是协程？
    - 协程
5. 图2.3中的“Restart”状态需要解释一下。
    - Restart状态是候选状态，seL4在Ready状态（在就绪队列里）和Runing之间设置的一种状态，表示该线程处于候选，如果没有其他意外（参数校验失败、地址空间非法等），下次返回用户态时，该候选线程会被激活为Runing状态，已新增相关描述。
6. 2.2.4节需要说清楚同步IPC与通知的区别。
    - 已新增区别
7. 第二章需要一个小结，描述seL4的主要特征，并说明你会借用的优点和你会改进的不中。
    - 已新增本章小结。
    - 在IPC小结中指出了seL4的设计不足

### 第三章（20250412）

对应的[学位论文版本](https://github.com/CtrlZ233/graduation_thesis/blob/f816c2dfdf9ecf7d8175a94d59dc53eeba825712/ReL4.pdf)

1. 建议在图3.1中画两条虚线，划分一下用户态、内核态和硬件。
    - 已修改
2. 图3.1和3.2的标题需要修改。目前两个图标题是一样的。
    - 已修改
3. 3.1.2节的描述可以细致一些。建议说清楚混合轮询在什么情况下是中断方式，什么时候是轮询方式的，两种方式间的切换条件是什么。
    - 已新增描述
4. 图3.4与3.2.2节的文字描述有些对不上，应该在图中体现出优先级位图。
    - 图3.4将worker协程与dispatcher协程分开，同时新增位图描述。
5. 第三章需要有一个小结，总结这一章的结果。第四章和第五章也有类似情况需要处理。
    - 新增了本章小结
    - 第四、五章也都新增了本章小结

### 第四章

1. 3.2.2节说的硬件是TAIC，4.1节是UINTC。需要有一个地方把这两种中断控制器介绍一下。如果你选择只说TAIC，那就更新所有与UINTC相关的描述。
    - 已修改相关表述，这里将TAIC硬件作为可选项，内核为用户态中断和TAIC提供类似的系统调用，但TAIC支持用户态直接通知内核态，因此不需要WakeSyscallHandler系统调用。
2. 图4.1和3.4都是说“调度器结构”的，但它们很不一样。建议把它们画成类似，第二个图可详细一些；也可以只画一个图，在两处分别从不同的角度来讨论。
    - 图4.1是笔误，应该是IPC流程示意图，图3.4讨论的是调度器结构，而图4.1讨论的是异步IPC流程，一个是结构图，一个是流程图，文字讨论也是从结构和流程两个角度来讨论的。
3. 算法1中需要加必要的注释，以方便理解。算法2也有类似情况需要处理。
    - 已新增必要的注释，并将算法1拆开为两个算法
4. 4.3节中关于优先级的讨论过于简略。建议用单独的一个三级标题来讨论优先级相关的内容。赵方亮的TAIC中也有优先级内容，但我没有看出你这里的讨论与他的优先级有什么关系。
    - 这里扩充了对执行优先级的描述，关于协程优先级和TAIC的关系，已经在3.2.2节中进行了描述，这里不再赘述。
5. 4.4.3节的标题“同步系统调用于异步系统调用”语言不通。
    - 已修改
6. 4.4.3节与3.2.3节的内容有重复。感觉你没有要写的了，但实际情况是，你还有许多重要内容没有讨论。你怎么看？
    - 确实有重复，已经删除3.2.3节关于异步系统调用的兼容性描述，3.2.3更强调兼容性的设计方面，4.4.3节强调做法。

### 第五章

1. 这一章的开头介绍可以分成两部分，一部分是开头的本章内容介绍，另一部分是实验环境介绍。建议把实验环境介绍写在单独的一个小节。
    - 已新增实验环境介绍的小节
2. 5.1节第二段中说的“通知机制和IPC机制差异导致的测试用例适配性修改”需要进一步的讨论。可以把这个修改放到用户态的库中并保持API一致吗？
    - 因为该测例是直接调用系统调用的，我们在系统调用层面是不兼容的，所以只能修改测例，具体做法是将测例修改为调用用户态库的API，已在文中新增表述。
3. 表5.2中不能通过的5个能力传递测例需要进一步的说明。另外，请说明一下，seL4test中有多少测例，你通过的测例的占比。
    - 除了4.4节中提到的不兼容的特性，其他测例均可通过，已新增表述。
4. 5.2节开头的介绍主要描述你要做些什么实验，不建议在这里说实验的结论。
    - 已删除实验结论的表述
5. 图5.1(b)的数据是在什么场景下得到的？我认为，这个数据与实验场景（中断频率、中断处理的计算量、干扰负载等）有密切关系。有必要把这个实验做得细致一些。
    - 是在UINTC平台下的16个客户端并发度请求ping-pong的IPC服务场景下得到的，没有计算量和干扰负载、中断频率的信息可以在后续IPC实验看到，

### 第六章

1. 摘要、1.3节和结论这三个部分的写作还需要好好修改。我对你的论文贡献概括如下，供你参考。
   * 设计并实现了异步微内核ReL4，保持与seL4 API基本兼容；
     * 基于UINTC和TAIC硬件支持，在ReL4中设计并实现异步通知机制；
     * 基于异步通知机制，在ReL4中设计并实现异步IPC和系统调用；
